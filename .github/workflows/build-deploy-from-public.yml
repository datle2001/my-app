name: build-deploy-from-public

on:
 push:
  branches: [ "master" ]
      
 pull_request:
  branches: [ "master" ]
  
    # Allows you to run this workflow manually from the Actions tab
 workflow_dispatch:
 
permissions:
 id-token: 'write'
 pages: 'write'
      
jobs:
 build:
  runs-on: ubuntu-latest
  
  steps:
   - name: Checkout
     uses: actions/checkout@v4
     with:
      ref: master
      submodules: recursive
     
   - name: Setup Node.js
     uses: actions/setup-node@v4.0.2
     with:
      node-version: 20

   - name: Install dependencies
     run: npm install react-scripts --save

   - name: Build with npm
     run: npm run build

   - name: Install gh-pages
     run: npm install --save gh-pages


 deploy:
  runs-on: ubuntu-latest
  
  needs: build
  
  steps:
   - name: Deploy with npm
     run: npm run deploy

  environment:
   name: github-pages
   url: ${{ steps.deployment.outputs.page_url }}
